Проект содержит два приложения для работы с сетевым трафиком:

1. **gen-app** - клиент-серверное TCP/IPv4 приложение
2. **sniffer** - анализатор сетевого трафика в реальном времени

## Требования

- **ОС**: GNU/Linux x64 (Debian 11 или новее)
- **Компилятор**: GCC/Clang с поддержкой C++20
- **Зависимости**:
    - libpcap-dev (для sniffer)
    - cmake (3.20+)

## Сборка проекта

### Сборка из корня проекта

````bash
# Прямая сборка в корне проекта
cmake -B build -S .
cmake --build build
````

### Результат сборки

После успешной сборки в директории `build/bin/` будут созданы:

- `gen-app` - клиент-серверное приложение
- `sniffer` - анализатор сетевого трафика
- `gen_app_tests` - тесты для gen-app
- `sniffer_tests` - тесты для sniffer

## Приложение gen-app

Клиент-серверное TCP/IPv4 приложение с использованием epoll и неблокирующих сокетов.

### Режим сервера

Сервер ожидает подключения, читает данные, дожидается закрытия соединения и продолжает работу.

````bash
# Запуск сервера на localhost:12345
./gen-app --addr localhost:12345 --mode server
````

````bash
# Запуск сервера c опцией логирования
./gen-app --addr localhost:12345 --mode server --log
````

### Режим клиента

Клиент поддерживает заданное количество параллельных соединений к серверу без ограничения времени. Каждое соединение
выполняет подключение, передачу случайных данных и закрытие, после чего создается новое соединение.

```bash
# Запуск клиента с 512 параллельными соединениями
./gen-app --addr localhost:8000 --mode client --connections 512 --seed 1337
```

### Параметры командной строки

- `--addr <host:port>` - адрес сервера (обязательно)
- `--mode <server|client>` - режим работы (обязательно)
- `--connections <N>` - количество параллельных соединений (только для клиента)
- `--seed <S>` - зерно для генератора случайных чисел (только для клиента)
- `--log` - включить лог событий

### Завершение работы

Для завершения работы используйте **Ctrl-C** (SIGINT).

### Обработка ошибок соединения

1. При запуске клиента происходит проверка доступности сервера. Если сервер не доступен - клиент
   завершает работу и сообщает, например:
   ````
   [error] Сервер недоступен: 127.0.0.1:12345
   [error] Контекст: при инициализации клиента
   [error] Нет активных соединений. Завершение работы клиента.
   [error] Не удалось инициализировать клиент
   [error] Проверьте доступность сервера: 127.0.0.1:12345
   ````
2. Если сервер завершает работу, клиент проводит несколько попыток переподключения и завершает работу:
   ````
   [client] Соединение разорвано сервером: fd=5
   [client] Закрыто соединение: fd=5
   [error] Сервер недоступен: 127.0.0.1:12345
   [error] Контекст: при создании соединения
   [error] Нет активных соединений. Завершение работы клиента.
   [error] Не удалось пересоздать соединение
   [error] Нет активных соединений. Сервер может быть недоступен.
   [error] Завершение работы клиента.
   [client] Активных соединений: 0
   ````

## Приложение sniffer

Анализатор сетевого трафика в реальном времени на основе библиотеки libpcap.

### Функциональность

- Захват TCP/IPv4 пакетов через libpcap
- Выделение 4-tuple (IP-адреса и TCP-порты источника и назначения)
- Расчет статистики для каждого потока:
    - Средний размер пакета на уровне Ethernet
    - Количество переданных байтов в полезной нагрузке TCP
    - Средняя скорость передачи данных
- Вывод ТОП-10 потоков по скорости передачи каждую секунду
- Многопоточная архитектура

### Параметры командной строки

- `--interface <interface>` - сетевой интерфейс для анализа (обязательно)
- `--log` - включить логирование в файлы
- `--help` или `-h` - показать справку

### Примеры использования

```bash
# Базовый анализ на loopback интерфейсе
sudo ./sniffer --interface lo
```

```bash
# Анализ с логированием (файлы создаются в logs/)
sudo ./sniffer --interface eth0 --log
```

```bash
# Анализ WiFi трафика
sudo ./sniffer --interface wlan0
```

### Завершение работы

Для завершения работы используйте **Ctrl-C** (SIGINT).

## Тестирование

### Запуск тестов

```bash
# Сборка с тестами (по умолчанию включены)
cmake -B build -S . -DBUILD_TESTS=ON
cmake --build build
```

```bash
# Запуск тестов
./build/bin/gen_app_tests
./build/bin/sniffer_tests
```

### Интеграционное тестирование

1. Запустите сервер в одном терминале:
   ```bash
   ./gen-app --addr localhost:12345 --mode server
   ```

2. Запустите sniffer в другом терминале:
   ```bash
   sudo ./sniffer --interface lo
   ```

3. Запустите клиент в третьем терминале:
   ```bash
   ./gen-app --addr localhost:12345 --mode client --connections 512 --seed 42
   ```

4. Наблюдайте за статистикой в sniffer

````
=== ТОП-10 TCP потоков по скорости передачи данных ===
========================================================================================
Source          Port    Destination     Port    Speed       AvgSize   Bytes     Packets 
----------------------------------------------------------------------------------------
127.0.0.1       58956   127.0.0.1       12345   2.3 KB/s    267.2     2332      10      
127.0.0.1       58974   127.0.0.1       12345   2.3 KB/s    266.6     2326      10      
127.0.0.1       58548   127.0.0.1       12345   2.1 KB/s    392.7     2152      6       
127.0.0.1       58394   127.0.0.1       12345   2.1 KB/s    385.7     2110      6       
127.0.0.1       58800   127.0.0.1       12345   2.1 KB/s    297.2     2106      8       
127.0.0.1       58572   127.0.0.1       12345   2.1 KB/s    383.0     2094      6       
127.0.0.1       58590   127.0.0.1       12345   2.1 KB/s    554.5     2082      4       
127.0.0.1       58946   127.0.0.1       12345   2.0 KB/s    238.0     2040      10      
127.0.0.1       58890   127.0.0.1       12345   2.0 KB/s    287.2     2026      8       
127.0.0.1       58538   127.0.0.1       12345   2.0 KB/s    368.7     2008      6       
========================================================================================
````
